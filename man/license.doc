\chapter{SWI-Prolog License Conditions and Tools}
\label{sec:license}

As of version 7.4.0\footnote{Actually pre-relase 7.3.33}, the SWI-Prolog
source code is distributed under the
\href{https://opensource.org/licenses/BSD-2-Clause}{Simplified BSD}
license:

\begin{verbatim}
    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions
    are met:

    1. Redistributions of source code must retain the above copyright
       notice, this list of conditions and the following disclaimer.

    2. Redistributions in binary form must reproduce the above copyright
       notice, this list of conditions and the following disclaimer in
       the documentation and/or other materials provided with the
       distribution.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
    FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
    COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
    INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
    BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
    LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
    CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
    LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
    ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    POSSIBILITY OF SUCH DAMAGE.
\end{verbatim}

This, unfortunately, \textbf{does not mean you can any version of
SWI-Prolog under the above license}. The SWI-Prolog core may be linked
to libraries that are more restrictive and in addition your code may
have loaded extension packages that have more restrictive conditions. In
particular, the core is by default linked to
\href{https://gmplib.org/}{libgmp}, distributed under the Lesser GNU
Public license. On Unix, SWI-Prolog is also linked to
\href{https://cnswww.cns.cwru.edu/php/chet/readline/rltop.html}{The GNU
Readline Library}, distributed under the General GNU Public license.

The above implies you need to configure and recompile the system without
these components. For this we provide options to the \program{configure}
script:

\begin{code}
./configure --without-gpl
./configure --without-lgpl
\end{code}

Dropping the GNU Readline Library from a packaged product is in most
cases not a big loss. The GNU MP Bignum Library however provides
unbounded integers, rational numbers and some cryptographical
functionality. As libgmp is provided under the Lesser GNU Public license
it may legally be combined with proprietary software as long as libgmp
is \jargon{dynamically linked} (default) and the end user can replace
the libgmp shared object and use your application with their (possibly
modified) version of libgmp. In practice this leads to problems if the
application is not accessible (e.g., embedded in closed hardware) or you
want to avoid customers to peek around in the process memory as they can
easily do so by adding a backdoor to the modified LGPL component. Note
that such a protection is in general not possible anyway if the customer
has root access to the machine on which the application runs.


\section{Contributing to the SWI-Prolog project}	\label{sec:contrib}

To reach maximal coherence we will, as a rule of thumb, only accept new
code that has the Simplified BSD license and existing code with a
\jargon{permissive} license such as MIT, Apache, BSD-3, etc. In
exceptional cases we may accept code with GPL or LGPL conditions. Such
code must be tagged using a license/1 directive (Prolog) or a call to
PL_license() for foreign code and, if they are part of the core,
the code must be excluded using the \verb$--without-gpl$ or
\verb$--without-lgpl$ option.


\section{Software support to keep track of license conditions}
\label{sec:softlicense}

Given the above, it is possible that SWI-Prolog packages and extensions
rely on the GPL or LGPL. The predicates below allow for registering
license requirements for Prolog files and foreign modules. The predicate
eval_license/0 reports which components from the currently configured
system are distributed under copy-left and open source enforcing
licenses (the GPL) and therefore must be replaced before distributing
linked applications under non-free license conditions.

\begin{description}
    \predicate{license}{0}{}
Evaluate the license conditions of all loaded components.  If the system
contains one or more components that are licenced under GPL-like
restrictions the system indicates this program may only be distributed
under the \const{GPL} license as well as which components prohibit the
use of other license conditions.  Likewise for for LGPL components.

    \predicate{license}{2}{+LicenseId, +Component}
Register the fact that \arg{Component} is distributed under a license
identified by \arg{LicenseId}. The most important \arg{LicenseId}'s are:

    \begin{description}
	\termitem{gpl_swipl}{}
This is the `old' license used for the Prolog components of SWI-Prolog.
It is probably still used by many libraries written for SWI-Prolog.
Please consider migrating such libraries to the Simplified BSD license.
If you are not able or not willing to do so, add a directive like this:

\begin{code}
:- license(gpl_swipl, mygreatlib).
\end{code}

The license indicates this module is distributed under the GNU General
Public License (GPL) with the SWI-Prolog exception:%
    \footnote{This exception is a straight re-phrasing of the license
	      used for \file{libgcc}, the GNU C runtime library facing
	      similar technical issues.}

\begin{quote}\it
As a special exception, if you link this library with other files,
compiled with SWI-Prolog, to produce an executable, this library does
not by itself cause the resulting executable to be covered by the GNU
General Public License. This exception does not, however, invalidate any
other reasons why the executable file might be covered by the GNU
General Public License.
\end{quote}

	\termitem{lgpl}{}
This is the default license for foreign libraries linked with
SWI-Prolog. Use PL_license() to register the condition from foreign
code.

	\termitem{gpl}{}
Indicates this module is strictly Free Software, which implies it cannot
be used together with any module that is incompatible with the GPL. Please
only use these conditions when forced by other code used in the
component.
    \end{description}

Other licenses known to the system are \const{guile}, \const{gnu_ada},
\const{x11}, \const{expat}, \const{sml}, \const{public_domain},
\const{cryptix}, \const{bsd}, \const{zlib}, \const{lgpl_compatible}
and \const{gpl_compatible}.  New licenses can be defined by adding
clauses for the multifile predicate license:license/3.  Below is
an example.  The second argument is either \const{gpl} or \const{lgpl}
to indicate compatibility with these licenses.  Other values cause the
license to be interpreted as \jargon{proprietary}.  Proprietary licenses
are reported by eval_license/0.  See the file \file{boot/license.pl} for
details.

\begin{code}
:- multifile license:license/3.

license:license(mylicense, lgpl,
		[ comment('My personal license'),
		  url('http://www.mine.org/license.html')
		]).

:- license(mylicense).
\end{code}

    \predicate{license}{1}{+LicenseId}
Intended as a directive in Prolog source files.  It takes the current
filename and calls license/2.

    \cfunction{void}{PL_license}{const char *LicenseId, const char *Component}
Intended for the install() procedure of foreign libraries. This call can
be made \emph{before} PL_initialise().
\end{description}


\section{License conditions inherited from used code}
\label{sec:otherlicenses}

\subsection{Cryptographic routines}		\label{sec:cryptlicense}

Cryptographic routines are used in variant_sha1/2 and \pllib{crypt}.
These routines are provided under the following conditions:

\begin{verbatim}
Copyright (c) 2002, Dr Brian Gladman, Worcester, UK.   All rights reserved.

LICENSE TERMS

The free distribution and use of this software in both source and binary
form is allowed (with or without changes) provided that:

   1. distributions of this source code include the above copyright
      notice, this list of conditions and the following disclaimer;

   2. distributions in binary form include the above copyright
      notice, this list of conditions and the following disclaimer
      in the documentation and/or other associated materials;

   3. the copyright holder's name is not used to endorse products
      built using this software without specific written permission.

ALTERNATIVELY, provided that this notice is retained in full, this product
may be distributed under the terms of the GNU General Public License (GPL),
in which case the provisions of the GPL apply INSTEAD OF those given above.

DISCLAIMER

This software is provided 'as is' with no explicit or implied warranties
in respect of its properties, including, but not limited to, correctness
and/or fitness for purpose.
\end{verbatim}

% do not remove
